{% extends '_partials/base_main.html' %}
{% load static %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static '/styles/modulo_tecnico/ficha_atendimento.css' %}">
    <link rel="stylesheet" href="{% static '/styles/modulo_tecnico/offcanvas_agendar_retorno.css' %}">
    <meta name="csrf-token" content="{{ csrf_token }}">

    <!-- Quill -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

    <!-- FontsAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

{% endblock %}
{% block content %}    
    
    <div class="container_page">
        
        <!-- Identificação -->
        <div class="barra_identificacao">
            <a class="barra_identificacao_parte botao_voltar" style="justify-content: flex-start;" href="{% url 'tecnico_atendimentos' %}">
                <i class="material-symbols-outlined" style="font-size: 1.5vw;">arrow_back</i>
                Voltar
            </a>

            <div class="barra_identificacao_parte">
                <span>Atendimento {{ atendimento.atendimento_id }}</span>
            </div>
            
        </div>

        <!-- Funcionalidades -->
        <div class="barra_funcionalidades">
            
            <!-- Whatsapp -->
            <div class="funcionalidade" id="abrirOffcanvasWhatsapp">
                <i class="fa-brands fa-whatsapp" style="font-size: 1.5vw; vertical-align: middle;"></i>
                Whatsapp
            </div>

            <!-- Cancelar Atendimento -->
            <div class="funcionalidade" id="abrirOffcanvasCancelarAtendimento">
                {% if atendimentoCancelado %}
                    <i class="material-symbols-outlined" 
                        style="
                            font-size: 1.5vw; 
                            vertical-align: 
                            middle; color: var(--cancelado);
                            font-variation-settings: 'FILL' 1;">
                            cancel</i>
                    <span style="color: var(--cancelado)">Cancelado</span>
                {% else %}
                    <i class="material-symbols-outlined" style="font-size: 1.5vw; vertical-align: middle;">cancel</i>
                    Cancelar
                {% endif %}
            </div>
            
            <!-- Confirmar Atendimento -->
            <div class="funcionalidade" id="abrirOffcanvasConfirmarAtendimento">
                {% if atendimentoConfirmacao %}
                    <i class="material-symbols-outlined" 
                        style="
                            font-size: 1.5vw; 
                            vertical-align: 
                            middle; color: var(--verde-capital);
                            font-variation-settings: 'FILL' 1;">
                            check</i>
                    <span style="color: var(--verde-capital)">Atend. Confirmado</span>
                {% else %}
                    <i class="material-symbols-outlined" style="font-size: 1.5vw; vertical-align: middle;">check</i>
                    Confirmar Atend.
                {% endif %}
            </div>

            <!-- Agendar Retorno -->
            <div class="funcionalidade" id="abrirOffcanvasAgendarRetorno">
                {% if atendimentoRetorno %}
                    <i class="material-symbols-outlined" 
                        style="
                            font-size: 1.5vw; 
                            vertical-align: 
                            middle; color: var(--verde-capital);
                            font-variation-settings: 'FILL' 1;">
                            event_upcoming</i>
                    <span style="color: var(--verde-capital)">Retorno Agendado</span>
                {% else %}
                    <i class="material-symbols-outlined" style="font-size: 1.5vw; vertical-align: middle;">event_upcoming</i>
                    Agendar Retorno
                {% endif %}
            </div>

            <!-- Finalizar Atendimento -->
            <div class="funcionalidade" id="abrirOffcanvasFinalizarAtendimento">
                {% if atendimento.status == 'finalizado' %}
                    <i class="material-symbols-outlined" 
                        style="
                            font-size: 1.5vw; 
                            vertical-align: 
                            middle; color: var(--verde-capital);
                            font-variation-settings: 'FILL' 1;">
                            done_all</i>
                    <span style="color: var(--verde-capital)">Atend. Finalizado</span>
                {% else %}
                    <i class="material-symbols-outlined" style="font-size: 1.5vw; vertical-align: middle;">done_all</i>
                    Finalizar
                {% endif %}
                
            </div>
            
        </div>

        <!-- Container Atendimento -->
        <div class="container_atendimento">
            
            <!-- Dados do Atendimento -->
            <div class="container_atendimento_infos">

                <!-- Produtor -->
                <div class="atendimento_produtor">
                    <span><b>Produtor</b></span>
                    <span>Nome: <b>{{ atendimento.produtor.primeiro_ultimo_nome }}</b> ({{ atendimento.produtor.idade }} anos)</span>
                    <span>Município: {{ atendimento.produtor.uf_municipio }}</span>
                    <span>Celular: {{ atendimento.produtor.celular }}</span>
                    <span id="idAtendimentoTecnico" style="display: none;">{{ atendimento.id }}</span>
                </div>

                <!-- Identificação do Atendimento -->
                <div class="atendimento_dados">
                    <span><b>Identificação do Atendimento</b></span>
                    <span>ID: {{ atendimento.atendimento_id }}</span>
                    <span>Data: <b>{{ atendimento.data|date:'d/m/Y' }}</b></span>
                    <span>Hora: <b>{{ atendimento.hora }}</b></span>
                    <span id="statusAtendimento" data-status="{{ atendimento.status }}">Status:
                        {% if atendimento.status == 'agendado' %}
                            <span class='status atendimento_agendado'>Agendado</span>
                        {% endif %}
                        {% if atendimento.status == 'cancelado' %}
                            <span class='status atendimento_cancelado'>Cancelado</span>
                        {% endif %}
                        {% if atendimento.status == 'atendido' %}
                            <span class='status atendimento_atendido'>Atendido</span>
                        {% endif %}
                        {% if atendimento.status == 'finalizado' %}
                            <span class='status atendimento_finalizado'>Finalizado</span>
                        {% endif %}
                    </span>
                    <span>Substatus:
                        {{ atendimento.get_substatus_display }}
                    </span>
                </div>

                <!-- Tópico do Atendimento -->
                <div class="atendimento_dados">
                    <span><b>Tópico do Atendimento</b></span>
                    <span>Atividade: {{ atendimento.get_atividade_produtiva_display }}</span>
                    <span>Tópico: {{ atendimento.topico }}</span>
                    <span>Mais informações:
                        {% if atendimento.mais_informacoes %}
                            <br>{{ atendimento.mais_informacoes }}
                        {% else %}
                            não informado.
                        {% endif %}
                    </span>
                </div>

                <!-- Imagens Enviadas -->
                <div class="atendimento_dados">
                    <span><b>Imagens Enviadas</b></span>
                    <div class="atendimento_dados_imagens">
                        <div class="atendimento_dados_imagens__card">
                            {% if atendimento.imagem01 %}
                                <img src="{{ atendimento.imagem01 }}">
                            {% else %}
                                <i class="material-symbols-outlined" style="font-size: 2vw;">image</i>
                                Não enviada
                            {% endif %}
                        </div>
                        <div class="atendimento_dados_imagens__card">
                            {% if atendimento.imagem02 %}
                                <img src="{{ atendimento.imagem01 }}">
                            {% else %}
                                <i class="material-symbols-outlined" style="font-size: 2vw;">image</i>
                                Não enviada
                            {% endif %}
                        </div>
                        <div class="atendimento_dados_imagens__card">
                            {% if atendimento.imagem03%}
                                <img src="{{ atendimento.imagem01 }}">
                            {% else %}
                                <i class="material-symbols-outlined" style="font-size: 2vw;">image</i>
                                Não enviada
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Avaliação do atendimento -->
                <div class="atendimento_dados">
                    <span><b>Avaliação do Atendimento</b></span>
                    <div class="avaliacao__atendimento__estrelas">
                        <span class="estrela preenchida" data-value="1">★</span>
                        <span class="estrela preenchida" data-value="2">★</span>
                        <span class="estrela preenchida" data-value="3">★</span>
                        <span class="estrela preenchida" data-value="4">★</span>
                        <span class="estrela" data-value="5">★</span>
                    </div>
                    <span>Comentário: nenhum comentário.</span>
                </div>
                
            </div>

            <!-- Relatório -->
            <div class="container_atendimento_relatorio">

                <div><b>Relatório Técnico do Atendimento</b></div>

                <div class="area_relatorio">
                    <div id="editor" data-id="{{ atendimento.id }}" style="height: 100%;"></div>
                    <script type="text/plain" id="relatorioInicial">
                        {{ atendimento.relatorio|default_if_none:"" |safe }}
                    </script>
                    
                </div>                

                <div class="relatorio_botoes">

                    <div class="relatorio_botoes__infos">
                        <span id="contadorPalavras">Total de palavras: {totalPalavras}/100-500</span>
                        <span id="dataRelatorio">
                            Última atualização:
                            {% if atendimento.relatorio_atualizacao %}
                                {{ atendimento.relatorio_atualizacao|date:'d/m/Y h:i:s' }}
                            {% else %}
                                -
                            {% endif %}
                        </span>
                    </div>
                    
                    <div class="relatorio_botoes__funcoes">
                        <button class="btn btn-success" id="btnSalvarRelatorio" style="font-size: 0.8rem;">Salvar Relatório</button>
                        <button class="btn btn-primary" id="btnGerarRelatorio" style="font-size: 0.8rem;">Gerar Relatório</button>
                    </div>
                    
                </div>

            </div>

        </div>


        <!-- offcanvas whatsapp -->
        {% include 'modulo_tecnico/offcanvas_iniciar_atendimento.html' %}

        <!-- offcanvas cancelar -->
        {% include 'modulo_tecnico/offcanvas_cancelar_atendimento.html' %}

        <!-- offcanvas confirmar atendimento -->
        {% include 'modulo_tecnico/offcanvas_confirmar_atendimento.html' %}

        <!-- offcanvas agendar retorno -->
        {% include 'modulo_tecnico/offcanvas_agendar_retorno.html' %}

        <!-- offcanvas finalizar atendimento -->
        {% include 'modulo_tecnico/offcanvas_finalizar_atendimento.html' %}

        
          
    </div>

    <script src="{% static 'js/modulo_tecnico/ficha_atendimento.js' %}"></script>
    <script src="{% static 'js/modulo_tecnico/ficha_atendimento_status.js' %}"></script>

{% endblock %}